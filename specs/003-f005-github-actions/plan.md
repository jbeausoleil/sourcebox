# Implementation Plan: GitHub Actions CI/CD Pipeline

**Branch**: `003-f005-github-actions` | **Date**: 2025-10-14 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/003-f005-github-actions/spec.md`

**Note**: This plan was generated by the `/speckit.plan` command.

## Summary

Establish automated continuous integration using GitHub Actions to run tests, verify builds, check code quality, and track coverage across multiple platforms (macOS, Linux, Windows) and Go versions (1.21, 1.22). Workflow executes on every push and pull request, provides fast feedback (<5 minutes with caching), and displays status badges in README.md. Includes race detection, linting with golangci-lint, and coverage tracking with Codecov. Uses standard GitHub Actions (boring tech), free tier for open source, and enforces >80% coverage for core packages.

## Technical Context

**Language/Version**: Go 1.21 and 1.22 (matrix testing across both versions)

**Primary Dependencies**:
- GitHub Actions (actions/checkout@v4, actions/setup-go@v5, actions/cache@v3)
- golangci-lint (golangci/golangci-lint-action@v3)
- Codecov (codecov/codecov-action@v3)

**Storage**: GitHub Actions runners (standard ubuntu-latest, macos-latest, windows-latest)

**Testing**: `go test` with race detector (-race), coverage reporting (-coverprofile), atomic mode (-covermode=atomic)

**Target Platform**: Multi-platform CI (macOS Intel + ARM runners, Linux x86 runners, Windows x86 runners)

**Project Type**: Single project (CLI tool)

**Performance Goals**:
- Workflow execution time <5 minutes (typical changes with caching)
- Cache hit reduces time from ~5 min to ~2 min
- Matrix jobs run in parallel for faster feedback

**Constraints**:
- Must use free GitHub Actions tier (2,000 minutes/month)
- Must test on all 3 platforms (macOS, Linux, Windows)
- Must test on Go 1.21 and 1.22
- Must enable race detector (catches concurrency bugs)
- Must enforce >80% coverage for core packages
- Must run golangci-lint with zero warnings
- Must complete in <5 minutes (fast feedback)

**Scale/Scope**: Foundation for all subsequent development (weeks 4-12), critical quality gate for every commit and PR

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Core Principles Compliance

- ✅ **I. Verticalized > Generic**: N/A (infrastructure setup, no data generation)
- ✅ **II. Speed > Features**: Fast feedback (<5 min workflow with caching), parallel execution, module caching saves ~3 min
- ✅ **III. Local-First, Cloud Optional**: CI complements local testing (`go test ./...`), doesn't replace it. Developers still run tests locally before push.
- ✅ **IV. Boring Tech Wins**: Standard GitHub Actions (actions/checkout, actions/setup-go, actions/cache), golangci-lint (industry standard), Codecov (proven, boring, standard for open source)
- ✅ **V. Open Source Forever**: Free GitHub Actions tier (2,000 min/month), free Codecov for open source, no paywalls
- ✅ **VI. Developer-First Design**: Fast feedback, clear status badges, actionable errors, transparent progress (verbose test output)
- ✅ **VII. Ship Fast, Validate Early**: Automated testing prevents regressions, enables rapid iteration, catches bugs before code review

### Technical Constraints Compliance

- ✅ **1. Performance**: Workflow completes in <5 minutes with caching, <8 minutes cold
- ✅ **2. Distribution**: N/A (CI/CD infrastructure, no distribution)
- ✅ **3. Database Support**: N/A (testing infrastructure)
- ✅ **4. Cost**: $0 (free GitHub Actions tier: 2,000 minutes/month, free Codecov for open source)
- ✅ **5. Code Quality**: Enforces >80% coverage for core packages, runs golangci-lint with zero warnings, race detector enabled
- ✅ **6. License**: N/A (no code changes to licensed components)
- ✅ **7. Platform Support**: Tests on macOS (latest), Linux (ubuntu-latest), Windows (latest); Go 1.21 and 1.22

### Development Practices Compliance

- ✅ **1. TDD Required**: CI runs tests automatically on every push, enforces test quality
- ✅ **2. Test-After OK**: N/A (CI infrastructure, not application code)
- ✅ **3. Manual QA**: CI supplements manual QA, doesn't replace it. Manual testing still required before releases.
- ✅ **4. Ship in 12 Weeks**: CI/CD is Week 4 foundation, enables rapid iteration for subsequent features
- ✅ **5. Open Source Launch First**: CI/CD is public infrastructure, no proprietary components
- ✅ **6. Spec-Kit Workflow**: This plan follows /speckit.plan → /speckit.implement workflow
- ✅ **7. Indie Constraints**: Uses free tier services, minimal CI minutes consumption (~20-30 min/day)

### Legal Constraints Compliance

- ✅ **1. Independent Development**: Uses standard public GitHub Actions only, no employer resources
- ✅ **2. No Employer References**: N/A (infrastructure documentation)
- ✅ **3. Public Information Only**: All patterns from public GitHub Actions documentation, Go community best practices
- ✅ **4. Open Source Protection**: N/A (no licensing changes)
- ✅ **5. Illustrative Examples**: N/A (no company references in CI/CD)

### Anti-Patterns Avoidance

- ✅ **1. Feature Bloat**: CI/CD is core infrastructure (must-have), not feature bloat. Solves real developer pain (manual testing).
- ✅ **2. Enterprise-First**: Works in 30 seconds (workflow triggers immediately on push), not 6 weeks. Zero configuration required.
- ✅ **3. Complex Pricing**: Free forever (GitHub Actions free tier, Codecov free for open source)
- ✅ **4. Shiny Tech**: Standard GitHub Actions, golangci-lint, Codecov (boring, proven, widely used)
- ✅ **5. Over-Engineering**: Simple single workflow file (ci.yml), no complex conditional logic, no exotic configurations
- ✅ **6. Generic Data**: N/A (CI/CD infrastructure)
- ✅ **7. Premature Optimization**: Start with standard matrix (3 OS × 2 Go versions), optimize later if CI minutes become issue
- ✅ **8. Cloud-First**: CI is cloud-based by nature (GitHub Actions), but complements local testing (developers still run `go test ./...` locally)

### Gate Status: ✅ PASS

All constitutional requirements met. No violations to justify. Proceed to Phase 0 research.

## Project Structure

### Documentation (this feature)

```
specs/003-f005-github-actions/
├── spec.md              # Feature specification (input to /speckit.plan)
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command) ✅ COMPLETED
├── quickstart.md        # Phase 1 output (/speckit.plan command) ✅ COMPLETED
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

**Note**: `data-model.md` and `contracts/` are SKIPPED for this feature (F005 is CI/CD infrastructure, not data/API feature).

### Source Code (repository root)

```
sourcebox/
├── .github/
│   └── workflows/
│       └── ci.yml           # NEW: GitHub Actions workflow (F005 deliverable)
├── cmd/sourcebox/           # Existing: CLI entry point (F003)
│   └── main.go
├── pkg/                     # Existing: Internal packages (future features)
├── Makefile                 # Existing: Build automation (F004)
├── go.mod                   # Existing: Go module (F003)
├── go.sum                   # Existing: Go dependencies (F003)
└── README.md                # Existing: Updated with CI badges (F005)
```

**Structure Decision**: Single project (Go CLI tool). F005 adds only the `.github/workflows/ci.yml` workflow file and updates README.md with status badges. No new source code directories needed for CI/CD infrastructure.

**Key Files**:
- `.github/workflows/ci.yml`: GitHub Actions workflow definition (test + lint jobs, matrix strategy, caching)
- `README.md`: Updated with CI, Codecov, License, and Go Version badges

**Testing Structure** (no changes for F005):
- Unit tests: `*_test.go` files alongside source (Go convention)
- Integration tests: `*_integration_test.go` (future, when needed)
- Test coverage: Generated by `go test -coverprofile=coverage.txt -covermode=atomic ./...`

## Complexity Tracking

*No violations to justify. All constitutional requirements met.*

## Phase 0: Research Summary

All 10 research topics resolved. See [research.md](./research.md) for full details:

1. ✅ **GitHub Actions Workflow Structure**: Standard YAML with push/pull_request triggers, separate test/lint jobs
2. ✅ **Matrix Strategy**: 3 OS × 2 Go versions = 6 jobs, fail-fast: false
3. ✅ **Go Testing Configuration**: `-v -race -coverprofile=coverage.txt -covermode=atomic ./...`
4. ✅ **Caching Strategy**: Go modules cached with `${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}` key
5. ✅ **golangci-lint Integration**: Official action with version: latest, 5-minute timeout, ubuntu-latest only
6. ✅ **Codecov Integration**: Upload from all 6 matrix jobs, free tier for open source
7. ✅ **Status Badge URLs**: CI, Codecov, License, Go Version badges
8. ✅ **Workflow Performance**: <5 min via parallel execution, caching, incremental testing
9. ✅ **PR Quality Gates**: Branch protection requires all 7 status checks (manual setup required)
10. ✅ **Flaky Test Handling**: Track as bugs, fix root cause, no automatic retries

## Phase 1: Design Summary

**Data Model**: SKIPPED (F005 is CI/CD infrastructure, no data entities)

**API Contracts**: SKIPPED (F005 has no REST/GraphQL APIs)

**Quickstart Guide**: ✅ COMPLETED - See [quickstart.md](./quickstart.md) for:
- Workflow overview and execution flow
- Manual workflow trigger verification
- PR workflow testing
- Debugging failed workflows (5 common issues + fixes)
- Verification checklist (11 items)
- Performance monitoring guidelines
- Troubleshooting reference (7 topics)

**Agent Context Update**: ⏭️ PENDING - Run `.specify/scripts/bash/update-agent-context.sh claude` to update CLAUDE.md

## Next Steps

1. ✅ Phase 0 research completed (research.md)
2. ✅ Phase 1 design completed (quickstart.md, skipped data-model.md and contracts/)
3. ⏭️ Update agent context: Run `.specify/scripts/bash/update-agent-context.sh claude`
4. ⏭️ Phase 2 task generation: Run `/speckit.tasks` to generate tasks.md
5. ⏭️ Phase 3 implementation: Run `/speckit.implement` to execute tasks

## Deliverables

**Generated by /speckit.plan**:
- ✅ `specs/003-f005-github-actions/plan.md` (this file)
- ✅ `specs/003-f005-github-actions/research.md` (Phase 0 research decisions)
- ✅ `specs/003-f005-github-actions/quickstart.md` (Phase 1 verification guide)
- ⏭️ Updated `CLAUDE.md` (agent context update - run script)

**NOT generated by /speckit.plan** (skipped or separate commands):
- ⏭️ `specs/003-f005-github-actions/data-model.md` (SKIPPED - N/A for CI/CD)
- ⏭️ `specs/003-f005-github-actions/contracts/` (SKIPPED - N/A for CI/CD)
- ⏭️ `specs/003-f005-github-actions/tasks.md` (Phase 2 - run /speckit.tasks)

**Implementation artifacts** (created during /speckit.implement):
- `.github/workflows/ci.yml` (GitHub Actions workflow)
- Updated `README.md` (CI badges)
- Branch protection rules (manual GitHub settings configuration)

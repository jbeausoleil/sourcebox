# Implementation Plan: Cobra CLI Framework Integration

**Branch**: `004-f006-cobra-cli` | **Date**: 2025-10-14 | **Spec**: [specs/004-f006-cobra-cli/spec.md](spec.md)
**Input**: Feature specification from `/specs/004-f006-cobra-cli/spec.md`

**Note**: This plan was generated by the `/speckit.plan` command following the Spec-Kit workflow.

## Summary

Integrate the Cobra CLI framework to provide professional command structure, flag parsing, help generation, and shell completions for SourceBox. Initialize Cobra with `cobra-cli init`, create root command with global flags (`--verbose`, `--quiet`, `--config`), scaffold subcommands (`seed`, `list-schemas`), implement version command with build-time injection, and establish comprehensive help system. Foundation for all CLI functionality in F021 (Seed command) and F022 (List-schemas command).

**Technical Approach** (from research):
- Use cobra-cli tool for scaffolding standard project structure
- Implement version injection via Go ldflags at build time
- Define persistent flags on root command for global behavior (--verbose, --quiet, --config)
- Use local flags on subcommands for command-specific options (--schema, --records)
- Follow Cobra best practices for help text quality (Use/Short/Long/Example fields)
- Implement TDD with table-driven tests for command validation and flag parsing

## Technical Context

**Language/Version**: Go 1.21+ (existing project configuration from F003/F004)
**Primary Dependencies**:
  - github.com/spf13/cobra v1.8+ (CLI framework)
  - github.com/spf13/cobra-cli v1.3+ (scaffolding tool)
  - github.com/stretchr/testify (testing assertions)
**Storage**: N/A (CLI framework, no database)
**Testing**: Go testing package with table-driven tests, output buffer capture, flag parsing verification
**Target Platform**: Cross-platform CLI (macOS Intel/ARM, Linux x86_64/ARM64, Windows x86_64)
**Project Type**: Single binary CLI tool
**Performance Goals**:
  - Command parsing: <1ms overhead
  - Help display: <1 second response time
  - Version display: <100ms response time
  - Zero startup delay (statically compiled binary)
**Constraints**:
  - Must work out of box with zero configuration
  - Must provide comprehensive help for all commands
  - Must support both long (--verbose) and short (-v) flags
  - Must integrate with existing build system (F004 Makefile)
  - Version must be injected at build time (not hardcoded)
  - TDD required for all command logic
  - Must be cross-platform compatible
**Scale/Scope**: Foundation for all CLI functionality (weeks 4-12), every feature will extend this structure

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Core Principles Compliance

✅ **I. Verticalized > Generic**: N/A - CLI infrastructure, not data generation
✅ **II. Speed > Features**: Command parsing <1ms, help display <1s, version <100ms (constitutional requirement met)
✅ **III. Local-First, Cloud Optional**: Pure local CLI tool, zero network dependencies, works offline
✅ **IV. Boring Tech Wins**: Cobra is de facto standard (kubectl, Hugo, gh all use it), proven and battle-tested
✅ **V. Open Source Forever**: Cobra is MIT licensed, integrates seamlessly with SourceBox MIT license
✅ **VI. Developer-First Design**: CLI-first tool, comprehensive help, clear errors, zero config
✅ **VII. Ship Fast, Validate Early**: Standard Cobra patterns accelerate development, TDD required

### Technical Constraints Compliance

✅ **1. Performance**: <100ms help/version (meets requirement), <1ms parsing overhead
✅ **2. Distribution Channels**: Compiles into single Go binary (no additional dependencies)
✅ **3. Database Support**: N/A (CLI framework)
✅ **4. Cost Constraints**: $0 (Cobra is free, open source)
✅ **5. Code Quality Standards**: Unit tests required for all commands, >80% coverage target
✅ **6. Open Source License**: Cobra MIT license (compatible with SourceBox MIT)
✅ **7. Platform Support**: Cobra works on all platforms (macOS, Linux, Windows)

### Legal Constraints Compliance (CRITICAL)

✅ **1. Independent Development**: Cobra is public, standard Go framework (no proprietary dependencies)
✅ **2. No Employer References**: N/A (CLI infrastructure, no company references)
✅ **3. Public Information Only**: All patterns from public Cobra documentation and open source examples
✅ **4. Open Source Protection**: Cobra MIT license, no proprietary dependencies, clean-room development
✅ **5. Illustrative Examples Only**: N/A (no third-party references needed)

### Development Practices Compliance

✅ **1. TDD Required**: TDD mandatory for command logic, flag parsing, help output (>80% coverage)
✅ **3. Manual QA Before Release**: Manual testing on macOS, Linux, Windows required
✅ **4. Ship MVP in 12 Weeks**: F006 is 2-day feature (on schedule for 12-week MVP)
✅ **6. Spec-Kit Driven Workflow**: Following /speckit.specify → /speckit.plan → /speckit.implement
✅ **7. Indie Project Constraints**: 10-15 hours/week scope, personal equipment, outside work hours

### UX Principles Compliance

✅ **1. Speed > Features**: <100ms response time (no compromise on speed)
✅ **2. Zero Config**: Works out of box with sane defaults (no setup required)
✅ **3. Transparent Progress**: N/A for CLI framework (applies to data generation commands)
✅ **4. Fail Gracefully**: Clear error messages with actionable fixes (documented in research.md)
✅ **5. Boring CLI**: Functional > flashy (standard Cobra output, no unnecessary animations)

### Anti-Patterns Avoidance

✅ **1. Feature Bloat**: Only essential commands/flags (seed, list-schemas, core flags)
✅ **2. Enterprise-First**: Simple CLI first, enterprise features in Phase 3 (after validation)
✅ **3. Complex Pricing in Phase 1**: N/A (CLI is free forever)
✅ **4. Shiny Tech**: Cobra is boring, proven tech (not experimental)
✅ **5. Over-Engineering**: Simple command structure, standard Cobra patterns
✅ **6. Generic Data**: N/A (CLI framework, not data)
✅ **7. Premature Optimization**: Scaffold only, implement in F021/F022 (no premature work)
✅ **8. Cloud-First**: Works entirely offline (no network dependencies)

### Gate Status: ✅ PASSED

**Violations**: None
**Justifications Required**: None
**Proceed to**: Phase 0 Research (completed) → Phase 1 Design (completed) → Phase 2 Implementation

## Project Structure

### Documentation (this feature)

```
specs/004-f006-cobra-cli/
├── plan.md              # This file (generated by /speckit.plan)
├── research.md          # Phase 0 output (10 research decisions)
├── quickstart.md        # Phase 1 output (verification guide)
├── spec.md              # Feature specification (input)
└── tasks.md             # Phase 2 output (/speckit.tasks - NOT created yet)
```

**Note**: `data-model.md` and `contracts/` SKIPPED - not applicable for CLI framework (no data entities, no REST APIs)

### Source Code (repository root)

```
cmd/sourcebox/           # CLI entry point
├── main.go              # Entry point, version injection
└── cmd/                 # Command definitions
    ├── root.go          # Root command, global flags, Execute()
    ├── root_test.go     # Root command tests
    ├── seed.go          # Seed command (scaffolded, implemented in F021)
    ├── seed_test.go     # Seed command tests
    ├── list_schemas.go  # List-schemas command (scaffolded, implemented in F022)
    └── list_schemas_test.go  # List-schemas tests

pkg/                     # Internal packages (future features)
├── generators/          # Data generation logic (F011-F020)
├── schema/              # Schema parsing (F008)
└── database/            # Database connectors (F023-F024)

go.mod                   # Go module (updated with Cobra dependencies)
go.sum                   # Dependency checksums
Makefile                 # Build automation (updated for version injection)
```

**Structure Decision**: Single project structure (Option 1). CLI tool follows Go conventions:
- `cmd/sourcebox/` → Binary entry point (main package)
- `cmd/sourcebox/cmd/` → Command definitions (reusable cmd package)
- `pkg/` → Internal libraries (not yet populated, future features)
- Tests colocated with implementation (`*_test.go` pattern)

This structure follows:
- Cobra best practices (main.go + cmd/ pattern)
- Go project layout standards
- F004 existing directory structure

## Complexity Tracking

*Fill ONLY if Constitution Check has violations that must be justified*

**No violations** - Constitution Check passed with no exceptions.

---

## Planning Artifacts Generated

This planning phase produced the following deliverables:

1. ✅ **plan.md** (this file)
   - Technical context defined
   - Constitution compliance verified (all gates passed)
   - Project structure documented
   - Ready for implementation phase

2. ✅ **research.md**
   - 10 research decisions documented
   - Cobra initialization pattern
   - Root command architecture
   - Global vs persistent flags
   - Subcommand scaffolding
   - Version injection mechanism
   - Help text quality standards
   - Flag validation patterns
   - Command testing strategies
   - Error handling standards
   - Shell completion integration

3. ✅ **quickstart.md**
   - Complete verification workflow
   - Phase-by-phase instructions
   - cobra-cli installation
   - Root command customization
   - Subcommand scaffolding
   - Build and test procedures
   - Version injection verification
   - Unit testing setup
   - Troubleshooting guide
   - Performance verification

4. ⏭️ **data-model.md** - SKIPPED (N/A for CLI framework)
5. ⏭️ **contracts/** - SKIPPED (no REST/GraphQL APIs)
6. ✅ **CLAUDE.md** - Updated with CLI framework context (via agent context script)

---

## Next Steps

**Phase 2: Task Generation** (separate command)
- Run `/speckit.tasks` to generate implementation tasks
- Tasks will be based on:
  - Research decisions (10 patterns documented)
  - Quickstart verification steps
  - TDD requirements (>80% coverage)
  - Constitutional compliance gates

**Implementation Workflow** (F006 execution)
- T001: Install cobra-cli tool
- T002: Initialize Cobra structure
- T003: Customize root command
- T004: Add global flags
- T005: Update main.go for version injection
- T006: Scaffold seed command
- T007: Scaffold list-schemas command
- T008: Update Makefile for version injection
- T009: Write unit tests (TDD)
- T010: Manual QA on macOS, Linux, Windows
- T011: Documentation updates

**Ready to proceed**: Constitution gates passed, research complete, design artifacts generated.

---

## References

- **Feature Specification**: [specs/004-f006-cobra-cli/spec.md](spec.md)
- **Research Decisions**: [specs/004-f006-cobra-cli/research.md](research.md)
- **Quickstart Guide**: [specs/004-f006-cobra-cli/quickstart.md](quickstart.md)
- **Constitution**: [.specify/memory/constitution.md](../../.specify/memory/constitution.md)
- **Cobra Documentation**: https://github.com/spf13/cobra
- **cobra-cli Documentation**: https://github.com/spf13/cobra-cli
